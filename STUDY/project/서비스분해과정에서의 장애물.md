# 서비스 분해 과정에서의 장애물 

- 모놀리스 아키텍처로 실제로 설계 및 운영 되어져 있고 이를 MSA로 전환하는게 목표라면? 
- **모놀리식에서 MSA로 전환하는 과정에 있다면, 우리가 고려해야 할 것들은?**

## 네트워크 지연 (Network Latency)

### 모놀리식 케이스 - 배달 주문앱을 통해, 고객이 카드 결제가 포함된 주문 접수를 요청한다면?
요청부터 응답까지 걸리는 시간에 포함되는 것은? 
1. 모바일 클라이언트 -> 주문 접수 모듈
2. 주문 접수 모듈/결제 모듈에서의 비즈니스 로직 + DB access
3. 결제 모듈에서 카드사로 통신 (e.x. HTTP call)
4. 카드사로부터의 Response 후, 추가적인 비즈니스 로직 + DB access
5. 모바일 클라이언트 리턴

### MSA 케이스 - 배달 주문앱을 통해, 고객이 카드 결제가 포함된 주문 접수를 요청한다면?
요청부터 응답까지 걸리는 시간에 포함되는 것은?
1. 모바일 클라이언트 -> 주문 접수 서비스
2. 주문 접수 서비스에서의 비즈니스 로직 + DB access
3. 주문 접수 서비스 -> 결제 서비스 통신 (e.x. HTTP)
4. 결제 서비스에서의 비즈니스 로직 + DB access
3. 결제 서비스에서 카드사로 통신 (e.x. HTTP call)
4. 카드사 로부터의 Response 후, 추가적인 비즈니스 로직 + DB access
5. 결제 서비스 로부터의 Response 후 , 주문 접수 서비스에서 추가 비즈니스 로직 + DB access
5. 모바일 클라이언트 리턴


- HTTP 통신 부분이 많아져서 응답 속도가 지연될 수있다.
> 해결방안 : 재시도 로직의 고도화, 모니터링 강화

## 트랜잭션 
### 모놀리식 케이스 - 배달 주문앱을 통해, 고객이 카드 결제가 포함된 주문 접수를 요청한다면?
요청부터 응답까지 걸리는 시간에 포함되는 것은?
1. 모바일 클라이언트 -> 주문 접수 모듈
2. 주문 접수 모듈/결제 모듈에서의 비즈니스 로직 + DB access
3. 결제 모듈에서 카드사로 통신 (e.x. HTTP call)
   - 성공 : 카드사로부터의 Response 후, 추가 비즈니스 로직 + DB access
   - **실패 : 실패에 대한 비즈니스 로직 + DB access**
4. 카드사로부터의 Response 후, 추가적인 비즈니스 로직 + DB access
5. 모바일 클라이언트 리턴

### MSA 케이스 - 배달 주문앱을 통해, 고객이 카드 결제가 포함된 주문 접수를 요청한다면?
요청부터 응답까지 걸리는 시간에 포함되는 것은?
1. 모바일 클라이언트 -> 주문 접수 서비스
2. 주문 접수 서비스에서의 비즈니스 로직 + DB access
3. 주문 접수 서비스 -> 결제 서비스 통신 (e.x. HTTP)
   - 실패 가능 
4. 결제 서비스에서의 비즈니스 로직 + DB access
5. 결제 서비스에서 카드사로 통신 (e.x. HTTP call)
   - 실패 가능
6. 카드사 로부터의 Response 후, 추가적인 비즈니스 로직 + DB access 
7. 결제 서비스 로부터의 Response 후 , 주문 접수 서비스에서 추가 비즈니스 로직 + DB access 
8. 모바일 클라이언트 리턴

>  해결방안 : 보상 트랜잭션, Saga Pattern

## 가용성
- 요청에 대해서, **해야하는 일**이 얼마나 오랜시간 운영이 가능한지를 나타내는 정도
### 모놀리식 케이스 - 배달 주문앱을 통해, 고객이 카드 결제가 포함된 주문 접수를 요청한다면?
- 외부의 경우 불가피 하지만, 내부 통신 구간에서 문제가 생긴다면? 
  - 내부 모듈을 통해 **호출 가능했을 수** 있던 Call에 문제 가능성이 올라간다.
    - -> **분해로 인해 필연적으로 가용성 낮아진다.**

- 요청이 다음 스텝(모듈/서비스)으로 얼마나 잘 갈 수 있을지?

> 해결방안 : 비통기 통신, 가용성 문제 해결을 위한 "서킷 브레이커"